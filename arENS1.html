<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>AR Cube - Réalité augmentée</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- A-Frame + AR.js -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: white;
      overflow: hidden;
      font-family: sans-serif;
    }

    /* Logo fixe en haut-centre */
    #logo {
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      width: 150px;
      z-index: 10;
      pointer-events: none;
    }

    /* Écran de préchargement */
    #preload {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      background-color: white;
      z-index: 999;
    }

    #preload img {
      width: 150px;
      animation: pulse 1s infinite alternate;
    }

    @keyframes pulse {
      from { opacity: 0.5; transform: scale(1); }
      to { opacity: 1; transform: scale(1.1); }
    }

    /* Masquer la scène avant activation */
    a-scene {
      display: none;
    }
  </style>
</head>
<body>
  <!-- Préchargement -->
  <div id="preload">
    <img src="LogoAr.png" alt="Chargement...">
  </div>

  <!-- Logo fixe -->
  <img id="logo" src="LogoAr.png" alt="Logo">

  <!-- Scène A-Frame AR -->
  <a-scene
    embedded
    arjs="sourceType: webcam; debugUIEnabled: false;"
    vr-mode-ui="enabled: false"
    renderer="antialias: true; alpha: true">
    
    <a-entity id="cube"
              geometry="primitive: box"
              material="color: white; opacity: 0.9"
              position="0 0 -2"
              scale="0 0 0"
              rotation="0 45 0">
    </a-entity>

    <a-entity camera></a-entity>
  </a-scene>

  <script>
    const preload = document.getElementById('preload');
    const scene = document.querySelector('a-scene');
    const cube = document.querySelector('#cube');
    let cubeVisible = false;

    // --- Étape 1 : Préchargement pendant 4 secondes ---
    window.addEventListener('load', () => {
      setTimeout(() => {
        preload.style.display = 'none';
        scene.style.display = 'block'; // Active la scène
      }, 4000);
    });

    // --- Étape 2 : Clic sur la scène pour afficher le cube ---
    scene.addEventListener('click', () => {
      if (!cubeVisible) {
        cubeVisible = true;
        cube.setAttribute('animation__scale', {
          property: 'scale',
          to: '1 1 1',
          dur: 600,
          easing: 'easeOutElastic'
        });
      }
    });

    // --- Étape 3 : Rotation et zoom interactif ---
    let lastX = 0, lastY = 0, rotating = false;
    let initialDistance = 0, initialScale = 1;

    scene.addEventListener('touchstart', e => {
      if (e.touches.length === 1) {
        rotating = true;
        lastX = e.touches[0].clientX;
        lastY = e.touches[0].clientY;
      } else if (e.touches.length === 2) {
        initialDistance = Math.hypot(
          e.touches[0].clientX - e.touches[1].clientX,
          e.touches[0].clientY - e.touches[1].clientY
        );
        const scale = cube.getAttribute('scale');
        initialScale = scale.x;
      }
    });

    scene.addEventListener('touchmove', e => {
      if (e.touches.length === 1 && rotating && cubeVisible) {
        const dx = e.touches[0].clientX - lastX;
        const dy = e.touches[0].clientY - lastY;
        const rot = cube.getAttribute('rotation');
        cube.setAttribute('rotation', {
          x: rot.x + dy * 0.5,
          y: rot.y + dx * 0.5,
          z: rot.z
        });
        lastX = e.touches[0].clientX;
        lastY = e.touches[0].clientY;
      } else if (e.touches.length === 2 && cubeVisible) {
        const newDist = Math.hypot(
          e.touches[0].clientX - e.touches[1].clientX,
          e.touches[0].clientY - e.touches[1].clientY
        );
        const scaleFactor = newDist / initialDistance;
        const newScale = Math.min(Math.max(initialScale * scaleFactor, 0.2), 3);
        cube.setAttribute('scale', `${newScale} ${newScale} ${newScale}`);
      }
    });

    scene.addEventListener('touchend', () => rotating = false);
  </script>
</body>
</html>
