<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<title>AR Objet 3D + Cam√©ra</title>
<style>
  html, body {
    margin: 0;
    height: 100%;
    overflow: hidden;
    background: #000;
  }

  video {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    object-fit: cover;
    z-index: 1;
  }

  canvas {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 2;
  }

  /* Logo fixe en bas */
  #logo-bottom {
    position: fixed;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%) scale(1);
    z-index: 3;
    transition: all 3s ease;
  }

  #logo-bottom img {
    height: 60px;
    width: auto;
    filter: drop-shadow(0 0 20px cyan);
  }

  /* Animation du logo (pr√©load) */
  #logo-bottom.animate {
    bottom: 45%;
    transform: translateX(-50%) scale(2);
  }
</style>
</head>
<body>

<!-- Cam√©ra -->
<video id="camera" autoplay playsinline></video>

<!-- Logo -->
<div id="logo-bottom"><img src="LogoAr.png" alt="Logo Bas"></div>

<!-- Librairies Three.js -->
<script type="module">
import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js';
import { GLTFLoader } from 'https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/loaders/GLTFLoader.js';
import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/controls/OrbitControls.js';

const video = document.getElementById('camera');
const logo = document.getElementById('logo-bottom');
let renderer, scene, camera, model;

// === 1. D√©marrage de la cam√©ra ===
async function startCamera() {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({
      video: { facingMode: { ideal: "environment" } },
      audio: false
    });
    video.srcObject = stream;
  } catch (err) {
    console.warn("Cam√©ra arri√®re non dispo, on passe √† la frontale.");
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ video: true });
      video.srcObject = stream;
    } catch (err2) {
      alert("Impossible d'acc√©der √† la cam√©ra : " + err2.message);
    }
  }
}
startCamera();

// === 2. Animation du logo (pr√©load) ===
setTimeout(() => logo.classList.add('animate'), 100);
setTimeout(() => {
  logo.classList.remove('animate');
  initScene();
}, 3100);

// === 3. Cr√©ation de la sc√®ne Three.js ===
function initScene() {
  scene = new THREE.Scene();
  camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 100);
  camera.position.set(0, 1, 3);

  renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  // Lumi√®res
  const light = new THREE.DirectionalLight(0xffffff, 1);
  light.position.set(2, 4, 5);
  scene.add(light);
  scene.add(new THREE.AmbientLight(0xffffff, 0.6));

  // === 4. Charger l'objet 3D ===
  const loader = new GLTFLoader();
  const modelURL = "https://modelviewer.dev/shared-assets/models/Astronaut.glb"; // üîπ Remplace par ton propre lien .glb
  loader.load(modelURL, (gltf) => {
    model = gltf.scene;
    model.scale.set(1.5, 1.5, 1.5);
    scene.add(model);
  }, undefined, (error) => {
    console.error("Erreur de chargement du mod√®le :", error);
  });

  // === 5. Contr√¥les utilisateur ===
  const controls = new OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;
  controls.enableZoom = true;
  controls.enablePan = true;
  controls.target.set(0, 1, 0);

  // === 6. Boucle d‚Äôanimation ===
  function animate() {
    requestAnimationFrame(animate);
    controls.update();
    renderer.render(scene, camera);
  }
  animate();

  // Resize
  window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
}
</script>

</body>
</html>
