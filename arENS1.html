<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>AR Image Interactive</title>
<style>
  html, body {
    margin: 0;
    height: 100%;
    overflow: hidden;
    background: #000;
    touch-action: none;
  }

  video {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    object-fit: cover;
    z-index: 1;
  }

  /* Image de préchargement avec effet lumière */
  #preload {
    position: fixed;
    top: 40%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0);
    z-index: 3;
    opacity: 0;
    transition: transform 1s ease, opacity 1s ease;
  }
  #preload.show {
    transform: translate(-50%, -50%) scale(1);
    opacity: 1;
    animation: glow 3s ease-in-out infinite alternate;
  }
  @keyframes glow {
    0% { filter: drop-shadow(0 0 5px cyan) brightness(1); }
    100% { filter: drop-shadow(0 0 25px white) brightness(1.5); }
  }
  #preload img {
    height: 120px;
    width: auto;
  }

  /* Image sur l’espace réel */
  #floating-image {
    position: absolute;
    top: 60%;
    left: 50%;
    transform: translate(-50%, -50%) rotate(0deg) scale(1);
    width: 200px;
    height: auto;
    border-radius: 10px;
    z-index: 3;
    display: none;
    transition: transform 0.2s ease;
    box-shadow: 0 0 20px rgba(255,255,255,0.4);
  }
</style>
</head>
<body>

<video id="camera" autoplay playsinline></video>

<!-- Image de préchargement -->
<div id="preload"><img src="LogoAr.png" alt="Logo de préchargement"></div>

<!-- Image sur l’espace -->
<img id="floating-image" src="https://www.pngplay.com/wp-content/uploads/13/Freepnglogos-Transparent-Background.png" alt="Objet interactif">

<script>
const video = document.getElementById('camera');
const preload = document.getElementById('preload');
const floatingImage = document.getElementById('floating-image');

// === 1. Ouvrir la caméra arrière ===
async function startCamera() {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({
      video: { facingMode: { ideal: "environment" } },
      audio: false
    });
    video.srcObject = stream;
  } catch (err) {
    console.error("Erreur caméra :", err);
  }
}
startCamera();

// === 2. Afficher le preload pendant 5s avec effet ===
setTimeout(() => preload.classList.add('show'), 100);
setTimeout(() => preload.remove(), 5100);

// === 3. Après 5s, afficher l’image interactive ===
setTimeout(() => {
  floatingImage.style.display = 'block';
  initGestures(floatingImage);
}, 5000);

// === 4. Gestes tactiles (drag, pinch, rotation) ===
function initGestures(el) {
  let posX = window.innerWidth/2, posY = window.innerHeight/1.6;
  let scale = 1, rotation = 0;
  let startX=0, startY=0;
  let initDist=0, initScale=1, initAngle=0, initRotation=0;

  function getDistance(touches) {
    const [t1, t2] = touches;
    return Math.hypot(t2.clientX - t1.clientX, t2.clientY - t1.clientY);
  }
  function getAngle(touches) {
    const [t1, t2] = touches;
    return Math.atan2(t2.clientY - t1.clientY, t2.clientX - t1.clientX);
  }

  el.addEventListener('touchstart', (e) => {
    if (e.touches.length === 1) {
      startX = e.touches[0].clientX - posX;
      startY = e.touches[0].clientY - posY;
    } else if (e.touches.length === 2) {
      initDist = getDistance(e.touches);
      initScale = scale;
      initAngle = getAngle(e.touches);
      initRotation = rotation;
    }
  });

  el.addEventListener('touchmove', (e) => {
    e.preventDefault();
    if (e.touches.length === 1) {
      posX = e.touches[0].clientX - startX;
      posY = e.touches[0].clientY - startY;
    } else if (e.touches.length === 2) {
      const newDist = getDistance(e.touches);
      scale = initScale * (newDist / initDist);
      const newAngle = getAngle(e.touches);
      rotation = initRotation + (newAngle - initAngle) * (180/Math.PI);
    }
    el.style.transform = `translate(${posX - window.innerWidth/2}px, ${posY - window.innerHeight/2}px) rotate(${rotation}deg) scale(${scale})`;
  });
}
</script>
</body>
</html>
