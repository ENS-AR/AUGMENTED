<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title> MANUEL AR - VIDEO </title>
<style>
  html, body {
    margin: 0;
    height: 100%;
    overflow: hidden;
    background: #000;
    touch-action: none;
  }

  video {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    object-fit: cover;
    z-index: 1;
  }

  #logo-bottom {
    position: fixed;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%) scale(1);
    z-index: 3;
    transition: all 1s ease;
  }

  #logo-bottom img {
    height: 25px;
    width: auto;
    transition: transform 1s ease;
  }

  #logo-bottom.animate {
    bottom: 45%;
    transform: translateX(-50%) scale(2);
  }

  /* Conteneur vidéo YouTube */
  #floating-video {
    position: absolute;
    top: 60%;
    left: 50%;
    transform: translate(-50%, -50%) rotate(0deg) scale(1);
    width: 300px;
    height: 170px;
    border-radius: 10px;
    z-index: 3;
    display: none;
    opacity: 0;
    transition: transform 0.2s ease, opacity 0.6s ease;
    background: #000;
  }

  #floating-video iframe {
    width: 100%;
    height: 100%;
    border: none;
    border-radius: 10px;
  }
</style>
</head>
<body>

<video id="camera" autoplay playsinline></video>

<div id="floating-video">
  <iframe src="https://youtu.be/mL5ijP7YJOk?si=X08IcR4ENTIh6wBP" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</div>

<div id="logo-bottom"><img src="LogoAr.png" alt="Logo Bas"></div>

<script>
const video = document.getElementById('camera');
const logo = document.getElementById('logo-bottom');
const floatingVideo = document.getElementById('floating-video');

async function startCamera() {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({
      video: { facingMode: { ideal: "environment" } },
      audio: false
    });
    video.srcObject = stream;
  } catch (err) {
    console.error("Erreur caméra :", err);
  }
}
startCamera();

setTimeout(() => {
  logo.classList.add('animate');
}, 100);

setTimeout(() => {
  logo.classList.remove('animate');
  showFloatingVideo();
}, 3100);

function showFloatingVideo() {
  floatingVideo.style.display = 'block';
  setTimeout(() => floatingVideo.style.opacity = '1', 100);
  initGestures(floatingVideo);
}

function initGestures(el) {
  let posX = window.innerWidth/2, posY = window.innerHeight/1.6;
  let scale = 1, rotation = 0;
  let startX=0, startY=0;
  let initDist=0, initScale=1, initAngle=0, initRotation=0;

  function getDistance(touches) {
    const [t1, t2] = touches;
    return Math.hypot(t2.clientX - t1.clientX, t2.clientY - t1.clientY);
  }
  function getAngle(touches) {
    const [t1, t2] = touches;
    return Math.atan2(t2.clientY - t1.clientY, t2.clientX - t1.clientX);
  }

  el.addEventListener('touchstart', (e) => {
    if (e.touches.length === 1) {
      startX = e.touches[0].clientX - posX;
      startY = e.touches[0].clientY - posY;
    } else if (e.touches.length === 2) {
      initDist = getDistance(e.touches);
      initScale = scale;
      initAngle = getAngle(e.touches);
      initRotation = rotation;
    }
  });

  el.addEventListener('touchmove', (e) => {
    e.preventDefault();
    if (e.touches.length === 1) {
      posX = e.touches[0].clientX - startX;
      posY = e.touches[0].clientY - startY;
    } else if (e.touches.length === 2) {
      const newDist = getDistance(e.touches);
      scale = initScale * (newDist / initDist);
      const newAngle = getAngle(e.touches);
      rotation = initRotation + (newAngle - initAngle) * (180/Math.PI);
    }
    el.style.transform = `translate(${posX - window.innerWidth/2}px, ${posY - window.innerHeight/2}px) rotate(${rotation}deg) scale(${scale})`;
  });
}
</script>

</body>
</html>

