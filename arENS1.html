<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Livre 3D sur espace réel</title>
<style>
  html, body {
    margin: 0;
    height: 100%;
    overflow: hidden;
    background: #000;
  }
  video {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    object-fit: cover;
    z-index: 1;
  }
  canvas {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 2;
  }
  #ui-logo {
    position: fixed;
    top: 10px;
    right: 20px;
    z-index: 3;
  }
  #ui-logo img {
    height: 30px;
    filter: drop-shadow(0 0 8px rgba(0,255,255,0.6));
  }
  #error {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.7);
    color: #fff;
    padding: 10px 20px;
    border-radius: 10px;
    display: none;
    z-index: 4;
    font-family: sans-serif;
  }
</style>
</head>
<body>
  <video id="camera" autoplay playsinline></video>
  <div id="ui-logo"><img src="LogoAr.png" alt="Logo"></div>
  <div id="error"></div>

<script type="module">
  import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js';

  const video = document.getElementById('camera');
  const errorMsg = document.getElementById('error');

  // === 1. Ouvrir la caméra ===
  async function startCamera() {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: { ideal: "environment" } },
        audio: false
      });
      video.srcObject = stream;
    } catch (err) {
      errorMsg.textContent = "Erreur caméra : " + err.message;
      errorMsg.style.display = "block";
    }
  }
  startCamera();

  // === 2. Créer la scène Three.js ===
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(70, window.innerWidth/window.innerHeight, 0.01, 100);
  camera.position.z = 2;

  const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  // === 3. Lumière ===
  const light = new THREE.DirectionalLight(0xffffff, 1);
  light.position.set(1, 1, 2);
  scene.add(light);
  scene.add(new THREE.AmbientLight(0xffffff, 0.5));

  // === 4. Créer un livre 3D (2 couvertures + pages) ===
  const coverMaterial = new THREE.MeshStandardMaterial({ color: 0x8B4513 });
  const pageMaterial = new THREE.MeshStandardMaterial({ color: 0xfdf6e3 });

  const coverThickness = 0.05;
  const coverWidth = 1.2;
  const coverHeight = 0.8;

  // Couverture arrière
  const backCover = new THREE.Mesh(
    new THREE.BoxGeometry(coverWidth, coverHeight, coverThickness),
    coverMaterial
  );
  backCover.position.z = 0;

  // Pages
  const pages = new THREE.Mesh(
    new THREE.BoxGeometry(coverWidth * 0.98, coverHeight * 0.95, coverThickness * 4),
    pageMaterial
  );
  pages.position.z = coverThickness * 2;

  // Couverture avant
  const frontCover = new THREE.Mesh(
    new THREE.BoxGeometry(coverWidth, coverHeight, coverThickness),
    coverMaterial
  );
  frontCover.position.z = coverThickness * 4;

  // Groupe "livre"
  const book = new THREE.Group();
  book.add(backCover);
  book.add(pages);
  book.add(frontCover);
  scene.add(book);

  // === 5. Animation du livre ===
  let angle = 0;
  function animate() {
    requestAnimationFrame(animate);
    angle += 0.01;
    book.rotation.y = Math.sin(angle) * 0.5; // léger mouvement
    book.rotation.x = 0.2;
    renderer.render(scene, camera);
  }
  animate();

  // === 6. Ajuster la taille de l’écran ===
  window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
</script>
</body>
</html>
